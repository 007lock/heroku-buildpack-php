#!/bin/bash
# Build Path: /app/.heroku/php/

OUT_PREFIX=$1

# fail hard
set -o pipefail
# fail harder
set -eux

echo "Building libmcrypt..."

echo "=== Downloading libmcrypt source..."

dep_version=${VERSION:-2.5.8}
dep_dirname=libmcrypt-${dep_version}
dep_archive_name=${dep_dirname}.tar.gz

curl -LO http://downloads.sourceforge.net/project/mcrypt/Libmcrypt/${dep_version}/${dep_archive_name}
tar xzf $dep_archive_name
pushd $dep_dirname

echo "=== Compiling libmcrypt..."
./configure --disable-posix-threads --prefix=$OUT_PREFIX
make
make install
popd


echo "=== Cleaning up..."
rm -fr ${dep_dirname} ${dep_archive_name}


echo "Done building libmcrypt."
